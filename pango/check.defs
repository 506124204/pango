#!/bin/bash

LANG=C

test -z "$srcdir" && srcdir=.
status=0

for def in $srcdir/*.def; do
	lib=${def%.def}
	lib=${lib##*/}
	so=.libs/lib${lib}-1.0.so

	test -f "$so" || continue
	echo Checking $def

	expected=$lib.expected
	list=$lib.list
	nm "$so" | grep ' T ' | cut -d' ' -f3 | sort -u > "$expected"
	cut -f 2 "$def" | grep -v EXPORTS > "$list"

	diff "$list" "$expected" && rm -f "$list" "$expected" || status=1
done

exit $status
