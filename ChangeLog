2006-09-13  Behdad Esfahbod  <behdad@gnome.org>

	Part of Bug 355782 – Misaligned extents in pango

	* pango/pango-layout.c (pango_layout_get_extents_internal),
	(pango_layout_get_extents), (pango_layout_iter_copy),
	(pango_layout_get_iter), (pango_layout_iter_get_line_extents):
	Add a new internal member layout_width to PangoLayoutIter.  Set it up
	in pango_layout_get_extents_internal and use in
	pango_layout_iter_get_line_extents to fix misalignment of ink link
	extents.

2006-09-13  Behdad Esfahbod  <behdad@gnome.org>

	"Thou shalt not touch code that does not fit in thy brain."

	* pango/pango-layout.c (update_cluster): Add cluster_start_index
	parameter back in.

2006-09-13  Behdad Esfahbod  <behdad@gnome.org>

	* pango/pango-engine.h: Remove unnecessary 'static' in type definition
	that causes a relocation.

	* pango/shape.c (pango_shape): Make sure last_cluster is invalid.

2006-09-13  Behdad Esfahbod  <behdad@gnome.org>

	Part of Bug 355782 – Misaligned extents in pango

	* pango/pango-layout.c (cluster_width): Rewrite based on
	is_cluster_start instead of accessing log_clusters directly.  This is
	more robust as next_cluster uses that, so the two match now.
	
	* pango/pango-layout.c (update_cluster): Remove the
	cluster_start_index parameter and use iter->cluster_start instead.

	* pango/pango-layout.c (pango_layout_iter_copy): Fix typo in copying
	iter->cluster_width.
	
	* pango/pango-layout.c (pango_layout_iter_get_cluster_extents): Add
	an assert to make sure iter->cluster_width is correctly set.

	* pango/pango-layout.c (pango_layout_iter_get_char_extents): Remove
	assert that was readded above to check more cases.

2006-09-12  Behdad Esfahbod  <behdad@gnome.org>

	Bug 355605 – hexbox with 0000 in it

	* modules/hangul/hangul-fc.c (render_syllable): If decomposition
	fails, backup and add a single hexbox glyph for the original
	character.

2006-09-11  Behdad Esfahbod  <behdad@gnome.org>

	Bug 355435 – Invalid calls to pango_map_get_engine()
	Patch from Theppitak Karoonboonyanan

	* pango/break.c (pango_get_log_attrs):
	* pango/pango-renderer.c (add_underline):
	* pango/pangofc-font.c (pango_fc_font_find_shaper):
	* pango/pangowin32.c (pango_win32_font_find_shaper):
	* pango/pangox.c (pango_x_font_find_shaper):
	Pass a PangoScript to pango_map_get_engine, not a gunichar!

2006-09-11  Behdad Esfahbod  <behdad@gnome.org>

	Bug 347146 – underline/overstrike spaces

	* pango/pango-renderer.c (add_underline), (add_strikethrough),
	(pango_renderer_draw_layout_line): Use logical extents for
	x and width of underline/strikethrough, such that trailing spaces are
	correctly handled.

	* pango/pango-layout.c (pango_layout_run_get_extents): Use logical
	rect for underline/strikethrough, and reflect that in run ink extents.

	* pango/pango-layout.c (pango_layout_line_get_extents): Don't
	let runs with empty ink extents affect total ink extents.

2006-09-10  Behdad Esfahbod  <behdad@gnome.org>

	Bug 352535 – Ink extents of empty glyph

	* pango/pangocairo-fcfont.c
	(pango_cairo_fc_font_get_glyph_extents): Return zero ink_rect for
	PANGO_GLYPH_EMPTY.

2006-09-08  Behdad Esfahbod  <behdad@gnome.org>

	* examples/cairotwisted.c: A simple text-on-path example using
	pangocairo.

	* examples/Makefile.am: Update.

2006-09-08  Behdad Esfahbod  <behdad@gnome.org>

	* pango/fonts.c (find_field_any): Parse style.  It was dropped when
	I was adding support for gravity.

2006-08-31  Behdad Esfahbod  <behdad@gnome.org>

	* pango/pango-layout.c, pango/pangox-fontmap.c, pango/pangox.c:
	Minor doc syntax update.

2006-08-30  Behdad Esfahbod  <behdad@gnome.org>

	Bug 148732 – cursor movenmet is not correct in gedit when I type
	Arabic text.

	* pango/pango-layout.c (pango_layout_move_cursor_visually): Update
	locally cached line properties upon line change.

2006-08-30  Behdad Esfahbod  <behdad@gnome.org>

	* modules/Makefile.am (pango.modules): Improve the conditional to
	ignore included modules.

2006-08-30  Behdad Esfahbod  <behdad@gnome.org>

	Bug 352811 – SIGSEGV with pango(cairo)-view on HP-UX

	* modules/Makefile.am (pango.modules): Don't hardcode .so extension.
	Look for .la instead.

2006-08-30  Behdad Esfahbod  <behdad@gnome.org>

	Bug 353525 – libpangoft2-1.0.so.0: undefined reference to
	`pango_font_description_get_gravity'

	* examples/Makefile.am: Explicitly link to the just built pangoft2 for
	pangocairo uses, like we already do for pangoxft.

2006-08-28  Tor Lillqvist  <tml@novell.com>

	* modules/basic/Makefile.am: Have basic-win32.c instead of
	basic-win32.lo depend on usp10.h so things work out also in case
	the basic-win32 module is compiled in.

2006-08-26  Behdad Esfahbod  <behdad@gnome.org>

	Bug 349813 – typo in docs for pango_layout_move_cursor_visually

	* pango/pango-layout.c (pango_layout_move_cursor_visually): Fix typo.

2006-08-23  Tor Lillqvist  <tml@novell.com>

	* pango/Makefile.am
	* examples/Makefile.am
	* pango/testfonts.c
	* examples/pangowin32tobmp.c: Rename pango/testfonts.c to
	examples/pangowin32tobmp.c. (#104151)

2006-08-22  Behdad Esfahbod  <behdad@gnome.org>

	* pango/pango-context.c (itemize_state_process_run): Replace (!isgraph
	&& !isspace) with (!isprint) which is equivalent.  Also, update
	comments.

2006-08-22  Behdad Esfahbod  <behdad@gnome.org>

	Part of Bug 145275 – Font selection for space characters

	* pango/pango-context.c (itemize_state_process_run): Find shaper/font
	for Private Use and space characters too.  Finding shaper for Private
	Use is needed for any practical use of those areas.  Ideally, spaces
	should be synthesized if they are not available in the font, but
	falling back to other fonts is far easier, and should give pretty good
	results with the current set of common fonts.  These fixes allow
	Firefox+Pango to render MathML like Firefox+Xft does.

2006-08-22  Behdad Esfahbod  <behdad@gnome.org>

	* pango/fonts.c (gravity_map): Rename "Upright" to "Not-Rotated".
	Also, reorder the user-friendly names (Not-Rotated, Rotated-Left, ...)
	before the enum names (South, East, ...) such that they are used to
	describe fonts.

2006-08-21  Behdad Esfahbod  <behdad@gnome.org>

	Bug 352114 – pango-1.14: generated docs still contain old example code

	* docs/tmpl/pangocairo.sgml: Update cairo example code to that of
	examples/cairosimple.c.

2006-08-20  Behdad Esfahbod  <behdad@gnome.org>

	Support per-item gravity.

	* pango/pango-context.c (update_attr_iterator),
	(itemize_state_init), (itemize_state_update_for_new_run),
	(itemize_state_process_run): Make per-item gravity work, by setting
	gravity into font description before loading fonts.  Also, allow
	the context font description to override the gravity (but not
	centered_baseline.)

	* pango/pangocairo-fcfont.c (_pango_cairo_fc_font_new): Get gravity
	from font description, not context.

	* pango/pangofc-fontmap.c (fontset_hash_key_equal),
	(fontset_hash_key_hash), (fontset_hash_key_copy),
	(pango_fc_make_pattern), (pango_fc_font_map_get_patterns),
	(pango_fc_font_map_load_fontset),
	(pango_fc_font_description_from_pattern): Get gravity from font
	description, not context.  Moreover, put it into pattern, and
	reconstruct it out of font patterns.

	* pango/pangofc-private.h: Define PANGO_FC_GRAVITY, which is the key
	we put PangoGravity into an FcPattern under.

2006-08-20  Behdad Esfahbod  <behdad@gnome.org>

	* docs/pango-sections.txt:
	* docs/tmpl/fonts.sgml:
	* pango/fonts.c (pango_font_description_set_gravity),
	(pango_font_description_get_gravity),
	(pango_font_description_merge_static),
	(pango_font_description_better_match),
	(pango_font_description_equal), (pango_font_description_hash),
	(find_field_any), (pango_font_description_from_string),
	(pango_font_description_to_string):
	* pango/pango-font.h:
	* pango/pango.def:
	Add gravity in PangoFontDescription.

2006-08-20  Behdad Esfahbod  <behdad@gnome.org>

	* pango/pango-matrix.c (pango_matrix_to_gravity): Correct switched
	return value of EAST/WEST.

	* pango/pango-types.h (PangoGravity): Add PANGO_GRAVITY_AUTO.
	* pango/pango-context.h: Add pango_context_get_gravity().

	* examples/renderdemo.c (parse_gravity), (parse_options):
	* pango/pango-context.c (pango_context_init),
	(update_resolved_gravity), (pango_context_set_matrix),
	(pango_context_set_base_gravity), (pango_context_get_gravity),
	(itemize_state_init), (get_shaper_and_font):
	* pango/pango-layout.c (line_set_resolved_dir):
	* pango/pangocairo-fcfont.c (pango_cairo_fc_font_get_metrics),
	(pango_cairo_fc_font_glyph_extents_cache_init),
	(_pango_cairo_fc_font_new):
	* pango/pangofc-fontmap.c (pango_fc_make_pattern),
	(pango_fc_font_map_load_fontset):
	* pango/pango.def:
	* docs/pango-sections.txt:
	* docs/tmpl/main.sgml:
	Update to above.

2006-08-20  Behdad Esfahbod  <behdad@gnome.org>

	* examples/renderdemo.c (parse_options):
	* examples/renderdemo.h: Change the --rotate parameter to double now
	that we depend on a recent-enough glib.

2006-08-20  Behdad Esfahbod  <behdad@gnome.org>

	Bug 351496 – PangoAnalysis::gravity breaks binary compatibility

	* pango/pango-item.h (PangoAnalysis): Use bitfields for level.

2006-08-17  Hans Breuer  <hans@breuer.org>

	* pango/makefile.msc pango/pango.def : updated
	* pango/break.c(1630) : error C2059: syntax error : '}' Intializing a 
	struct with empty braces is not supported with MSVC, instead use 0.
	* pango/pangocairo.def : removed pango_fc_font_(map_)get_type
	pangocairo has either win32 fonts or freetype. The former is more usual.
	* pango/pango-utils.c : replaced M_PI by G_PI (from glib/gtypes.h).

2006-08-17  Behdad Esfahbod  <behdad@gnome.org>

	Part of Bug 348825 – pango should optimize away calls to FcFontSort as
	much as possible

	* pango/pangofc-fontmap.c: Increase FONTSET_CACHE_SIZE from 16 to 64.

2006-08-17  Tor Lillqvist  <tml@novell.com>

	* pangowin32.pc.in: Drop @WIN32_LIBS@, no need to search -lgdi32
	when linking apps that link with libcairowin32.

	* pango/pango.def: Add two symbols.

2006-08-16  Behdad Esfahbod  <behdad@gnome.org>

	Bug 351585 – API documentation issues with 2.15 release

	* pango/fonts.c (pango_font_describe_with_absolute_size): Add Since
	tag to docs.

2006-08-16  Behdad Esfahbod  <behdad@gnome.org>

	* pango/pango-layout.c (line_set_resolved_dir): Adjust line
	resolved_dir according to context base_gravity, like we do
	in itemize_state_add_character().

2006-08-16  Behdad Esfahbod  <behdad@gnome.org>

	* examples/viewer-pangocairo.c (render_callback): Render block
	progression and line direction arrows, and a base gravity roof-top.

	* pango/pango-matrix.c (pango_matrix_to_gravity): New function.

	* pango/pango-utils.c (pango_gravity_to_rotation): New function.

	* pango/pangocairo-fcfont.c (_pango_cairo_fc_font_new): Use
	pango_gravity_to_rotation().

	* pango/pango-utils.h:
	* pango/pango-types.h:
	Reorder a bit.

	* examples/Makefile.am:
	* examples/test-chinese.txt: New test text for Chinese.

	* pango/check.defs: New script that checks that all the exported
	symbols are listed in the respective .def file. (only checks the
	libraries actually built.  No win32 for example.)

	* pango/Makefile.am: Hook check.defs as a 'make check' test.

	* pango/pango.def:
	* pango/pangoft2.def:
	* pango/pangocairo.def:
	Update.

	* docs/tmpl/glyphs.sgml:
	* docs/tmpl/main.sgml:
	* docs/pango-sections.txt:
	Update.

2006-08-16  Behdad Esfahbod  <behdad@gnome.org>

	* modules/basic/basic-fc.c (fallback_shape): Remove redundant
	positioning block!

2006-08-15  Behdad Esfahbod  <behdad@gnome.org>

	* pango/pango-layout.c (pango_layout_run_get_extents):
	* pango/glyphstring.c (pango_glyph_string_extents_range):
	Return if none of logical_rect or ink_rect is non-NULL.

	* pango/pango-item.h (PangoAnalysis): Add new member centered_baseline
	which if set, makes item rendered such that ascent == descent.

	* pango/pango-context.c (itemize_state_init),
	(itemize_state_add_character):
	* pango/pango-renderer.c (pango_renderer_draw_layout_line):
	Implement centered_baseline.

	* pango/pangocairo-fcfont.c (pango_cairo_fc_font_get_metrics): When
	adjusting ascent/descent for vertical fonts, adjust strikethrough and
	underline position too.

	* docs/tmpl/main.sgml: Document new struct member.

2006-08-15  Behdad Esfahbod  <behdad@gnome.org>

	* modules/basic/basic-fc.c (basic_engine_shape): Use analysis->gravity
	to detect vertical fonts, instead of poking into the font_pattern.

2006-08-15  Behdad Esfahbod  <behdad@gnome.org>

	* modules/basic/basic-fc.c (basic_engine_shape): Always use
	fallback shaping for vertical fonts.

	* pango/pango-context.c (get_shaper_and_font): Always use basic
	shaper for vertical items (east/west gravity).

2006-08-15  Behdad Esfahbod  <behdad@gnome.org>

	* examples/renderdemo.c (do_output): Render the header with SOUTH
	gravity.

	* pango/pangocairo-fcfont.c (pango_cairo_fc_font_get_metrics),
	(pango_cairo_fc_font_glyph_extents_cache_init): Center baseline
	for east/west gravity in pango_font_metrics too.

2006-08-15  Behdad Esfahbod  <behdad@gnome.org>

	* examples/HELLO.utf8: Remove excess LRM.

	* examples/viewer-pangocairo.c (render_callback): Draw baselines in
	border-drawing mode.

	* pango/pango-layout.c (pango_layout_line_get_extents): Make sure
	we set logical_rect.y on empty lines.  Previously empty lines had
	wrong baseline.  The code apparently was written like that
	intentionally, but I cannot find out why.

2006-08-15  Behdad Esfahbod  <behdad@gnome.org>

	* pango/break.c (pango_get_log_attrs): Remove initliazer members
	for analysis, let compiler zero them all.  Fixes compile break after
	adding the gravity member inside there.

2006-08-15  Behdad Esfahbod  <behdad@gnome.org>

	* pango/pango-context.c (itemize_state_add_character):
	Fix handling of WEST and EAST gravity effect on bidi level.

	* pango/pangocairo-fcfont.c
	(pango_cairo_fc_font_glyph_extents_cache_init):
	For NORTH gravity (upside down text), swap ascent and descent,
	and for EAST/WEST, center baseline between ascent/descent.

	* pango/shape.c (pango_shape): If glyph width is negative, negate
	it and shift glyph by that amount.  This allows having font matrices
	that essentially move the glyph origin to the right of the glyph to
	still work.

2006-08-15  Behdad Esfahbod  <behdad@gnome.org>

	* pango/pangocairo-fcfont.c (pango_cairo_fc_font_get_scaled_font),
	(_pango_cairo_fc_font_new): Move font_matrix rotation into font_new
	as we use only rotation and no translation anymore.

2006-08-15  Behdad Esfahbod  <behdad@gnome.org>

	* docs/pango-sections.txt:
	* docs/tmpl/main.sgml:
	* examples/renderdemo.c (parse_gravity), (parse_options):
	* pango/pango-context.c (pango_context_init),
	(pango_context_get_base_gravity), (itemize_state_add_character):
	* pango/pango-types.h:
	* pango/pangocairo-fcfont.c (pango_cairo_fc_font_get_scaled_font):
	* pango/pangofc-fontmap.c (pango_fc_make_pattern):
	Oops.  Exchange west<->east and north<->south gravities.  The gravity
	is the side that the glyph sits on.  So, for normal Latin text for
	example, gravity is south, not north.

2006-08-15  Behdad Esfahbod  <behdad@gnome.org>

	* examples/renderdemo.c (do_output), (parse_gravity),
	(parse_options): Support --gravity.

	* pango/pangocairo-fcfont.c (pango_cairo_fc_font_get_scaled_font),
	(compute_glyph_extents), (_pango_cairo_fc_font_new): Load rotated
	scaled_fonts to handle gravity.

	* pango/pangofc-fontmap.c (pango_fc_make_pattern),
	(pango_fc_font_map_get_patterns), (pango_fc_font_map_load_fontset):
	Set FC_VERTICAL_LAYOUT on West and East gravity.

2006-08-15  Behdad Esfahbod  <behdad@gnome.org>

	* pango/pango-context.c (itemize_state_process_run):
	Add FIXME note about handling item gravity.

	* pango/pangofc-fontmap.c (fontset_hash_key_equal),
	(fontset_hash_key_hash), (fontset_hash_key_copy),
	(pango_fc_font_map_get_patterns): Add gravity into the hask key.

2006-08-15  Behdad Esfahbod  <behdad@gnome.org>

	* pango/pango-item.h: Add a gravity member to PangoItem, and

	* pango/pango-context.c (itemize_state_init),
	(itemize_state_add_character): Propagate context base_gravity
	into items.

2006-08-15  Behdad Esfahbod  <behdad@gnome.org>

	* pango/pango-types.h: Add enum PangoGravity.

	* pango/pango-context.h:
	* pango/pango-context.c (pango_context_set_base_gravity),
	(pango_context_get_base_gravity): New functions.

	* pango/pango.def:
	* docs/pango-sections.txt: Hook new API.

Local Variables:
coding: utf-8
End:
vim: encoding=utf-8:
